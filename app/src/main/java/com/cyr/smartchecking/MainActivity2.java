package com.cyr.smartchecking;import android.os.Bundle;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.widget.CheckBox;import android.widget.EditText;import android.widget.ImageButton;import android.widget.ImageView;import android.widget.TextView;import android.widget.Toast;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import androidx.appcompat.widget.Toolbar;import androidx.lifecycle.Observer;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import com.cyr.smartchecking.Room.Person;import com.cyr.smartchecking.Room.PersonDatabase;import java.util.ArrayList;import java.util.List;public class MainActivity2 extends AppCompatActivity implements View.OnClickListener {  ArrayList<Person> personList;  ArrayList<Person> selectionList ;  private Toolbar toolbar;  private RecyclerView recyclerView;  MyAdapter2 adapter;  boolean isContexualModeEnabled=false;  TextView itemCounter;  ImageButton btnBack;  int counter = 0;  private EditText editTextSearch;  private ImageView searchIcon;  private ImageView filter;  private PersonDatabase personDatabase;  @Override  protected void onCreate(Bundle savedInstanceState) {    super.onCreate(savedInstanceState);    setContentView(R.layout.activity_main2);    toolbar=findViewById(R.id.toolBar);    setSupportActionBar(toolbar);    //Initilisation des vue pour la barre de recherche    editTextSearch = findViewById(R.id.editTextSearch);    searchIcon = findViewById(R.id.searchIcon);    filter = findViewById(R.id.filter);    searchIcon.setOnClickListener(new View.OnClickListener(){      @Override      public void onClick(View v) {        performSearch();      }    });    itemCounter=findViewById(R.id.itemCounter);    btnBack=findViewById(R.id.btnBack);    btnBack.setOnClickListener(new View.OnClickListener() {      @Override      public void onClick(View v) {        onBackPressed();      }    });    personDatabase = PersonDatabase.getInstance(this);    // Fetch data from the database and update the adapter    fetchDataFromDatabase();    recyclerView = findViewById(R.id.recycler2);    adapter = new MyAdapter2(personList,MainActivity2.this);    recyclerView.setLayoutManager(new LinearLayoutManager(this));    recyclerView.setAdapter(adapter);  }  private void fetchDataFromDatabase() {    // Observe the LiveData    personDatabase.getDao().getAllPersons().observe(this, new Observer<List<Person>>() {      @Override      public void onChanged(List<Person> persons) {        // Update the adapter with the fetched data        personList = new ArrayList<>(persons);        adapter.notifyDataSetChanged();      }    });  }  @Override  public boolean onCreateOptionsMenu(Menu menu) {    getMenuInflater().inflate(R.menu.menu_selection, menu);    return true;  }  @Override  public void onClick(View v) {    isContexualModeEnabled=true;    toolbar.getMenu().clear();    toolbar.inflateMenu(R.menu.contexual_menu);    RemoveContextualActionMode();    adapter.notifyDataSetChanged();  }  public void MakeSelection(View v, int adapterPosition) {    if (((CheckBox)v).isChecked()){      selectionList.add(personList.get(adapterPosition));      counter++;    }    else {      selectionList.remove(personList.get(adapterPosition));      counter--;    }    UpdateCounter();    // Si la suppression a été effectuée, réinitialiser l'état    if (counter == 0) {      resetState();    } else {      toolbar.inflateMenu(R.menu.contexual_menu);    }  }  public void  UpdateCounter()  {    itemCounter.setText(counter+" selection");  }  @Override  public boolean onOptionsItemSelected(@NonNull MenuItem item) {    if (item.getItemId()==R.id.delete){      adapter.RemoveItem(selectionList);      RemoveContextualActionMode();    }    return true;  }  private void RemoveContextualActionMode() {    isContexualModeEnabled=false;    toolbar.getMenu().clear();    toolbar.inflateMenu(R.menu.contexual_menu);    counter=0;    selectionList.clear();    adapter.notifyDataSetChanged();  }  public void resetState() {    isContexualModeEnabled = false;    counter = 0;    selectionList.clear();    adapter.notifyDataSetChanged();    // Réinitialiser le menu    toolbar.getMenu().clear();    toolbar.inflateMenu(R.menu.menu_selection);    itemCounter.setText("0 selection");  }  private void performSearch() {    String searchText = editTextSearch.getText().toString().toLowerCase().trim();    List<Person> filteredList = MyApp.getDatabase().getDao().searchPersonsByName(searchText);    for (Person person : personList) {      if (person.getName().toLowerCase().contains(searchText)) {        filteredList.add(person);      }      if (person.getSname().toLowerCase().contains(searchText)){        filteredList.add(person);      }    }    if (filteredList.isEmpty()) {      Toast.makeText(this, "Aucune donnée trouvée", Toast.LENGTH_SHORT).show();    } else {      adapter.setfilteredList(filteredList);    }  }}// toolbar.inflateMenu(R.menu.contexual_menu);